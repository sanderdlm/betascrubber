{% extends 'base.twig' %}

{% block nav_title %}
    {% if video_title %}
        <span class="title">{{ video_title }}</span>
    {% endif %}
{% endblock %}

{% block content %}
    {% if frames|length > 0 %}
        <div class="frames-header">
            Selected: <strong><span id="selected-count">0</span></strong> / {{ frames|length }}
        </div>

        <form action="/view-frames/{{ id }}" method="post" id="frames-form">
            <div class="frames-grid">
                {% for frame in frames %}
                    <div class="frame-item" data-frame="{{ frame }}">
                        <img src="{{ frame_urls[frame] }}" alt="{{ frame }}">
                        <div class="frame-number">{{ loop.index }}</div>
                    </div>
                {% endfor %}
            </div>

            <div class="sticky-footer">
                <button type="submit">
                    Continue
                </button>
            </div>
        </form>
    {% else %}
        <div class="empty-state">
            <p>No frames found</p>
        </div>
    {% endif %}

    <script>
        const selectedFrames = new Set();
        const frameItems = document.querySelectorAll('.frame-item');
        const selectedCount = document.getElementById('selected-count');
        const form = document.getElementById('frames-form');

        frameItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const frame = this.getAttribute('data-frame');

                if (selectedFrames.has(frame)) {
                    selectedFrames.delete(frame);
                    this.classList.remove('selected');
                } else {
                    selectedFrames.add(frame);
                    this.classList.add('selected');
                }

                selectedCount.textContent = selectedFrames.size;
            });
        });

        form.addEventListener('submit', function(e) {
            if (selectedFrames.size === 0) {
                e.preventDefault();
                alert('Select at least one frame');
                return;
            }

            selectedFrames.forEach(frame => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'selected_frames[]';
                input.value = frame;
                form.appendChild(input);
            });
        });
    </script>
{% endblock %}
