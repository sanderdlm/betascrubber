{% extends 'base.twig' %}

{% block nav_title %}
    {% if video_title %}
        <span class="title">{{ video_title }}</span>
    {% endif %}
{% endblock %}

{% block content %}
    {% if frames|length > 0 %}
        <div style="padding: 0.75rem 1rem; background: #f5f5f5; border-bottom: 1px solid #e0e0e0; text-align: center;">
            Selected: <strong><span id="selected-count">0</span></strong> / {{ frames|length }}
        </div>

        <form action="/view-frames/{{ id }}" method="post" id="frames-form">
            <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 1px; background: #e0e0e0;">
                {% for frame in frames %}
                    <div class="frame-item" data-frame="{{ frame }}" style="position: relative; background: #fff; cursor: pointer; outline: 4px solid transparent; outline-offset: -4px;">
                        <img src="{{ frame_urls[frame] }}" alt="{{ frame }}" style="width: 100%; display: block; pointer-events: none;">
                        <div style="position: absolute; bottom: 0; right: 0; background: rgba(0,0,0,0.7); color: #fff; padding: 0.25rem 0.5rem; font-size: 0.75rem; pointer-events: none;">{{ loop.index }}</div>
                    </div>
                {% endfor %}
            </div>

            <div style="position: sticky; bottom: 0; background: #fff; border-top: 1px solid #e0e0e0; padding: 1rem;">
                <button type="submit" style="width: 100%;">
                    Continue
                </button>
            </div>
        </form>
    {% else %}
        <div style="padding: 1rem;">
            <p>No frames found</p>
        </div>
    {% endif %}

    <script>
        const selectedFrames = new Set();
        const frameItems = document.querySelectorAll('.frame-item');
        const selectedCount = document.getElementById('selected-count');
        const form = document.getElementById('frames-form');

        frameItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                const frame = this.getAttribute('data-frame');

                if (selectedFrames.has(frame)) {
                    selectedFrames.delete(frame);
                    this.style.outlineColor = 'transparent';
                } else {
                    selectedFrames.add(frame);
                    this.style.outlineColor = '#000';
                }

                selectedCount.textContent = selectedFrames.size;
            });
        });

        form.addEventListener('submit', function(e) {
            if (selectedFrames.size === 0) {
                e.preventDefault();
                alert('Select at least one frame');
                return;
            }

            selectedFrames.forEach(frame => {
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'selected_frames[]';
                input.value = frame;
                form.appendChild(input);
            });
        });
    </script>
{% endblock %}
